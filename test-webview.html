<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'none'; 
                 script-src 'unsafe-inline' https://unpkg.com; 
                 style-src 'unsafe-inline' https://unpkg.com; 
                 img-src https: data:; 
                 font-src https://unpkg.com;">
  <title>OpenAPI Preview Test</title>
  <link rel="stylesheet" href="https://unpkg.com/@stoplight/elements@8.0.0/styles.min.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #1e1e1e;
      color: #d4d4d4;
    }
    
    #content {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    #elements {
      width: 100%;
      height: 100%;
    }
    
    /* Reduce padding in the right content panel */
    /* Override Stoplight's large padding classes (sl-px-24 = 96px) */
    elements-api .sl-px-24 {
      padding-left: 16px !important;
      padding-right: 16px !important;
    }
    
    /* Add vertical padding */
    elements-api .sl-overflow-y-auto {
      padding-top: 16px !important;
      padding-bottom: 16px !important;
    }
    
    /* Target the main content container */
    elements-api .sl-flex-1.sl-w-full {
      padding: 16px !important;
    }
    
    /* Reduce padding in nested content divs */
    elements-api .sl-flex-1.sl-w-full > div {
      padding: 16px !important;
    }
    
    /* Override Stoplight Elements CSS variables */
    elements-api {
      --padding: 16px;
      --spacing: 16px;
    }
    
    #error-container {
      padding: 20px;
      text-align: center;
    }
    
    .error-message {
      color: #f48771;
      background-color: #5a1d1d;
      border: 1px solid #be1100;
      padding: 16px;
      border-radius: 4px;
      margin: 20px auto;
      max-width: 600px;
    }
    
    .error-title {
      font-weight: bold;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div id="content">
    <div id="error-container" style="display: none;">
      <div class="error-message">
        <div class="error-title">Error Loading Preview</div>
        <div id="error-text"></div>
      </div>
    </div>
    <elements-api
      id="elements"
      apiDescriptionDocument=""
      layout="sidebar"
      router="hash"
      style="display: block; width: 100%; height: 100%;"
    />
  </div>

  <script src="https://unpkg.com/@stoplight/elements@8.0.0/web-components.min.js"></script>
  <script>
    (function() {
      const elementsApi = document.getElementById('elements');
      const errorContainer = document.getElementById('error-container');
      const errorText = document.getElementById('error-text');

      // Sample OpenAPI content
      const sampleOpenApi = `openapi: 3.0.0
info:
  title: Test API
  version: 1.0.0
  description: A test API for validation
paths:
  /users:
    get:
      summary: Get users
      responses:
        '200':
          description: Success
  /posts:
    get:
      summary: Get posts
      responses:
        '200':
          description: Success
components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string`;

      // Set initial content
      elementsApi.setAttribute('apiDescriptionDocument', sampleOpenApi);

      function showError(message) {
        errorText.textContent = message;
        errorContainer.style.display = 'block';
        elementsApi.style.display = 'none';
      }

      // Global error handler
      window.addEventListener('error', (event) => {
        console.error('Unhandled error in webview:', event.error);
        event.preventDefault();
      });

      // Global promise rejection handler
      window.addEventListener('unhandledrejection', (event) => {
        console.error('Unhandled promise rejection in webview:', event.reason);
        event.preventDefault();
      });

      console.log('Webview ready');
    })();
  </script>
</body>
</html>
